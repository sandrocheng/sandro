1、网关
	-相同网段的两个主机(通一个子网中的设备)通信是不需要经过网关的
	 不同网段的两个主机通信需要通过网关，因为TCP/IP规定，不同子网的设备是不能直接通信的，如果要通信则需要网关来转发
	 比如:192.168.0.1/24 和 192.168.0.2/24进行通信，这两个主机的网段是都是 192.168.0，因此不需要通过网关

	-网关中有两个网卡，分别连接内网和互联网中的某一个子网
	 当内网中的数据要通过网关发送的时候，会把目标mac改为网关mac发出，然后发送给网关
	 
	 网关拿到数据后，通过路由表查询，发现这一包数据属于互联网中的子网
         网关会修改mac地址，为互联网子网的某一个服务器(或者路由器)，修改源mac为自己的mac,然后从互联网子网网卡发出
	 这些根据目标IP判断如何发送的行为称之为路由	 

	-路由器结构图：1_路由器和网络的关系

	-traceroute命令(windows是 tracert命令)
	 通过traceroute我们可以知道信息从你的计算机到互联网另一端的主机是走的什么路径。
	 详见/doc/linux/linux常用命令.txt

2、公网、私网
	-私网和公网又称内网和外网，公网通常指Internet，私有IP是Internet保留给私人网络的IP

	-私网IP有如下几种类型
		类型A，IP范围 10.0.0.0~10.255.255.255
		类型B，IP范围 172.16.0.0~172.31.255.255
		类型C, IP范围 192.168.0.0~192.168.255.255
	-通过ifconfig就能在linux系统上查看当前的ip，不过一般都是内网ip,公网ip可以在百度上查询关键字"IP查询"

3、交换机
	-交换机主要的功能是把工具包发送的正确的位值，它根据数据包中的MAC地址找到目标主机的物理端口
	 它是一种基于MAC地址识别，能完成封装转发数据包功能的网络设备

	-交换机有多个端口，计算机的网卡通过网线和交换机的端口连接，每个端口都是确定的物理位值
	 我们只要知道某个计算机的mac地址连接在哪个端口上，就能正确的把数据包发送给他。
	 因此在交换机中会维护一张端口和mac地址的关系表，如图：3_交换机示意图
	 想要与某个MAC地址通信时，只需要查询一下这个MAC地址对应哪个端口号，然后从对应的端口发送就可以了

        -每个数据包有两个mac地址：源MAC，目标MAC
	 当数据包发送到交换机的时候会经过如下几个步骤
		1.源MAC与接收端口绑定 ，填入MAC地址表
		2.查找发出端口
			2.1 查到关联端口，则直接从关联端口发出
 		 	2.2 未查到关联端口，则向除了接收端口以外的所有端口群发一个数据包(泛洪)，如果目标MAC地址在这个网络中，则一定能收到群发的数据包		
                3.如此运行一段时间后通过交换机的mac地址表就可以找到网络中所有的网卡设备

	-交换机只关心数据包中的mac地址，而不会关心IP地址，mac地址在TCP/IP协议中属于数据链路层(第二层)，因此交换机也被称为二层设备
	 也有三层交换机或更高层的交换机，三层交换机同样可以有路由的功能，而且比低端路由器的转发速率更快。它的主要特点是：一次路由，多次转发

4、路由器
	-路由器也称选径器，是在网络层实现互联的设备。它比网桥(比如交换机)更加复杂，也具有更大的灵活性。路由器有更强的异种网互联能力，连接对象包括局域网和广域网。
	 过去路由器多用于广域网，近年来，由与路由器性能有了很大的提升，价格下降到与网桥接近，因此局域网互连中也越来越多的使用路由器，使用路由器连接多个网络或网段
	 
	-路由器有两大典型的功能，数据通道功能和控制功能，
	 数据通道功能，包括转发决定，背板转发以及输出链路调度等，一般由硬件来完成
	 控制功能一般用软件来实现，包括与相邻路由器之间的信息交换、系统配置、系统管理等。

	-路由器有两种类型的接口 WAN口，LAN口。如图4_路由器示意图
		LAN口，它没有路由信息，用于接入局域网的设备，比如电脑，手机，电视等，这些设备可以通过网线连接到LAN口，也可以通过WIFI连接到LAN口
		       LAN口连接的终端属于同一网段

            	WAN口，接入运营商网络，从而接入互联网，WAN端口可以配置路由信息，比如NAT配置，PPPOE拨号配置等
		       WAN口需要配置IP地址，获取IP地址方式通常有三种，自动获取，静态配置，PPPOE拨号获取
		       WAN口的模式一般有桥接模式和路由模式之分
	
	-如果路由器忽略WAN口，其是路由器就是一台交换机
	 WAN口主要的作用是为局域网内的终端提供网关

5、mac地址
	mac地址是网卡出厂自带的编号，由6个字节组成，比如00-16-EA-AE-3C-40,
	前三个字节表示网络硬件厂商编号，由IEEE国际性电子技术与电子工程师协会分配
	后三个字节表示该制造商锁制造的网卡的序列号，
	所以mac地址是全球唯一的地址。

6、IP地址
	IPv4，可使用的范围有42亿个,其中很多还被空出来用于私网，已经与2011年2月3日用尽
	IPv6,128位，几乎是无限大的范围

7、DHCP协议
	-终端连接到了路由器后，设备会自动向路由器发送DHCP请求，请求为其分配ip地址。
	 路由器接收到请求后会自动给终端分配ip地址，并通过DHCP回复报文发送回去。
	 操作系统收到回报后将ip地址配置到网卡上，注意在局域网中Ip地址也是唯一的，路由器不会重复分配相同的IP
	 当然也可以把DHCP关掉，手动为某一个网卡设置ip地址，但是要保证ip地址不能与当前子网中的其他设备的ip地址重复
	
	-DHCP请求IP流程
	 	1.终端开机或者刚连接上网线的时候，网卡是没有ip的，此是操作系统会使用UDP协议通过68端口向67端口发送广播一包DHCP discover数据包
	         由于这是一个广播数据包，所以网络中的所有设备都能收到这包数据，但只有DHCP服务器才会做出响应，比如在一个家庭网络中路由器就是DHCP服务器的角色
	
		2.路由器收到DHCP请求包，后会从自己的IP地址池中拿到一个空闲IP，路由器会把这个IP信息封装成一个DHCP offer包，回复给发起请求的终端

		3.终端收到offer包后会决定要不要使用这个ip
		 因为一个较复杂的网络中可能会有多个DHCP服务器，他们有可能同时收到discover包，各自分配地址后都回复了，因此pc可能会同时收到多个offer包
		 一般请情况下都是使用第一个offer包的ip地址
	
		4.终端决定使用分配的ip后，会向网络中广播自己的决定，通知路由器当前终端使用了哪个ip地址，这个包称为HDCP request包

		5.路由器收到后会回复DHCP ack包，表示已经接受了pc的选择
	 前两步是非必须的，终端首次拿到ip后一般都会在本地保存这个ip，系统重新启动后，只需要从第三步开始确认一下是否可以继续使用这个ip就可以了
	 如果可用，DHCP服务器会回复DHCP ack确认请求。
	 如果不可用，DHCP服务器会回复DHCP nack包拒绝申请，此是终端会从第一步开始重新再来一次完整的申请流程。
	 
	

8、arp协议
	-终端每发送的一包数据都需要填写数据链路层的源mac，目标mac和网络层的源ip,目标ip。一般用户会指定网络层的ip地址。而目标mac则必须通过arp协议获取

	-arp协议就是通过ip地址查询mac地址的协议，它属于链路层使用的协议
	 终端A向终端B发送IP消息的时候，终端A的操作系统不会立刻发出，它会先发送一个arp广播报文出去，在子网中的所有设备都会收到这个arp报文
	 每个设备收到arp报文后，判断报文中的目标IP地址是不是自己，如果是自己则返回自己的mac地址。
	 终端A收到回复后就知道了终端B的mac地址，它会把计算机B的mac地址缓存起来，以便下次使用，然后把ip消息报文中的对方mac地址补全，再发送出去。
 	 交换机根据数据包中的目标mac地址找到了终端B的端口，从此端口发送出去，终端B就收到了

	-arp协议的工作流程
	 	-假设终端A要向某个192.168.0.10的IP地址发送一段报文，准备好报文后会先暂存
		-终端A通过网络向外广播一包ARP请求报文
		 请求报文中的源ip和源mac都是终端A的MAC和IP，目标IP是需要查询的IP，也就是192.168.0.10，目标MAC是一个全0的MAC地址。
		 这些是网络层arp协议中的内容，数据链路层的目标MAC地址是全F的地址，表示在数据链路层进行广播
		-广播后网络中所有的设备都会收到请求报文，解析并查看目标地址是不是自己。
		-192.168.0.10终端发现请求包是发给自己的，会回复一个ARP报文，在回复报文中会填入自己的MAC地址
		 这个报文是使用单拨的方式进行回复的
		-终端A收到后从报文中取出mac地址，填入到事先暂存的发送报文中，再发送数据。
		-收到的MAC地址会写如到主机的MAC地址表中缓存起来，下次再有对相同ip发送数据的请求，就直接从ARP表中获取
		 若查询不到才会再次执行上述的ARP查询步骤

	-ARP表更新
		-当网络运行一段时间各终端通信过一段时间后，每个中端都有了全量的ARP表
		-此时，设备之间进行了ip切换，为了保证各终端的ARP表即时更新，更换IP的终端会向网络发送更新IP的ARP消息，这包数据不需要回复
		-网络中的其他设备收到这个ARP消息，就可以立即更新本地的ARP表了

	-ARP攻击
		假设网络中有多个终端，终端使用交换机连接，交换机连接一台路由器连接到互联网，如图：8_ARP攻击
		受到ARP攻击后，网络中的所有设备都无法正常访问互联网，而防御ARP攻击是一件非常困难的事情，因为这种ARP欺骗报文无法有效的进行检测
		最简单的方式是配置静态ARP，通过静态配置将网关的IP地址和MAC地址绑定，这种方法虽然普通用户操作起来有一定难度，但确实是最简单行之有效的方法
		 	

9、SNAT
	-SNAT,源地址转换技术
	
	-终端A在子网A中，ip是192.168.0.1，通过路由器访问的终端B在另一个子网中,ip地址也是192.168.0.1
	 为了保证ip地址的唯一性，数据到达网关后，会修改源地址IP，这就需要SNAT技术来修改源地址

	-如图:9_SNAT示意图

10、DNAT	
	-DNAT，目标地址转换技术，如图：10_DNAT
	 内网中的一台服务器要想接收到公网的数据，是需要通过路由器转发的。
	 路由器在收到公网的请求后就使用了DNAT技术把目标ip改成内网的服务器ip和端口，才能向内网转法请求。	

11、TCP/UDP协议
	-二者都是传输层的协议，用于应用之间的数据传输
	-TCP是基于连接的，UDP是基于非连接的
	 为了保证连接，TCP在创建连接的时候要三次握手，传输的时候要使用传输确认机制，退出连接的时候要又四次挥手
	 三次握手可以保证网络信道不可靠的情况下依然正确建立连接，比如网络信道不可靠，客户端可能发送多次SYN请求，服务端收到一个SYN请求后就会立即回复SYN+ACK,其他的SYN请求都会忽略掉
	 客户端收到SYN+ACK回发送ACK，服务端收到一次ACK后就立即建立连接
	
	-TCP可以在不可靠网络上建立可靠的数据连接，能够处理丢包问题和乱序问题
	 发送的时候数据由序列号+长度+报文组层，对等方收到后要回复的ACK = 序列号+长度=也就是下一个数据发送的起始序列号
	 这种一问一答的方式保证传输的数据的完整
	 发送端也可以一次发送多个包，接收端根据序列号拼接成完整的数据，如果某个序列号的数据没有收到，接收端会通知发送端重传。	 
	
	-UDP发送数据相对与TCP就简单很多，只是简单的封装数据和发送数据，数据包之间没有状态上的联系
	 因此UDP的性能损耗少，资源占用少，传输速度快，但是不能保证丢包和顺序问题。
	 UDP也常用于隧道网络比如vpn，以及SDN中用到的VXLAN。
		
12、ICMP协议和ping命令
	-当不确定目标ip的主机是否可以连通的时候一般都使用ping命令确认。
	 比如:ping 192.168.0.1 ,测试一下局域网中某台主机是否可以连通，也可以使用ping www.xxx.xxx来确认互联网的某台主机是否可以连通

	-ping命令使用的网络协议叫ICMP(internet control message protocol)协议即互联网控制消息协议
	 它的作用就是帮助网络管理员检测网络中的各种问题

	-ICMP的作用有两个
		-询问报告，比如询问目标主机是否可以连通，比如ping命令,如图：12_ping命令流程图
		-差错报告，比如网关发现目标网络不可达，或者目标主机发现访问的DUP端口不可达，需要把错误报告发送给源主机，比如linux的 traceroute命令(详见/doc/linux/linux常用命令.txt) 
		           如图：12_traceroute流程图

13、DNS协议
	-DNS是用来查询域名和IP的协议，下面是浏览器通过DNS获取IP的流程
		-浏览器输入网址后，首先从网址中取出域名，然后组建一包DSN查询报文，并发送到主机的上一级DNS服务器。
	 	 在开启DHCP的情况下，DNS服务器是会通过DHCP协议自动获取的，用户也可以手动配置

		-DNS服务器收到请求后，会在自己的DNS池中查询对应的IP地址，如果找不到会向其更上一级的DNS服务器进行查找，找到后会返回IP地址。

		-浏览器拿到IP地址后，会用此IP地址构建HTTP协议数据包，通过HTTP协议最终得到显示网页内容

		-为了提高效率，浏览器也不是每次都查询IP地址的，浏览器内会缓存查询到的域名和IP，并在一定时间内直接使用其结果

	-DNS服务器上下级关系的维护，如图：13_DNS服务器
	 	-互联网中有上亿的域名，他们保存在大量的DNS服务器中，并且每天都有大量的域名增加或修改。
	  	 比如在美国新上线了一个网站，在中国可以在很短的时间内解析域名并访问到其内容。这可以看出DNS服务器之间的维护是需要大量复杂工作的

	 	-比如 http://www.3g.qq.com这个域名，可以根据"."的位值进行等级划分
		 	com,表示公司
			qq,表示公司的子域名，表示qq项目组
			3g，是qq的子域名，表示移动互联网项目组
			www,是3g的子域名，是大家常用的前缀，表示万维网
		 在这个划分下，可以在qq下继续划分多个子域名，在3g下也可以划分多个子域名
		 com下也可以划分很多子域名，比如百度，阿里等
		
14、路由
	-通常所说的路由是指路由信息
	 路由信息就是去往目的地的一条信息，它指明了去往目的地的方向
	 另外，路由也可以表示寻径，是指路由器在收到IP包后，去查找自己的路由信息进行转发的过程。

	-路由表
	 存放路由信息的地方叫路由表，IP包的转发是根据路由表来实现的

	 路由条目包括5项内容，也叫五元组：
		前缀+掩码，比如10.1.0.0/24，表示这个子网的ip都是可以被服务的
		下一跳/出接口，
		管理距离(AD)或叫优先级
		度量
	
	 路由器转发IP包的原则：
		1.有路由匹配就转发，没有就丢弃
		2.匹配多条时遵循最长匹配原则,比如路由表中有两条路径 10.1.1.0/25，10.1.1.0/24 ，当请求Ip是10.1.1.1的时候，两条路径都匹配，路由器会选择最长的匹配也就是10.1.1.0/25
		3.路由表生成的三种途径
			a.直连自动生成
			b.静态路由协议
			c.动态路由协议	

	-路由协议
	 路由协议用于路由器之间帮助路由器构建路由表的网络协议
	 
	 小型网络可能只需要直连和静态路由就能构建完整的路由表
	 大型网络则必须使用动态路由协议让路由器之间相互学习路由信息从而构建完整的路由表

	-静态路由和动态路由的比较
		-静态路由
		 网络管理员手动地将静态路由输入到路由表中
		 网络拓扑改变需要手动更新路由
		 路由行为可以精确控制

		-动态路由
		 网络路由协议在拓扑或业务改变时自动调整动态路由
		 路由器通过动态的交换路由更新来学习和维护到原称目的地的路由
		 路由器通过共享路由表信息来发现新的网络

	-IP通信是双向的
	 从源访问目的经过的每一个网络节点都必须有去往目的网络的路由
	 从目的响应源经过的每一个网络节点都必须有去往源网络的路由
	 去向和回程是两条完全不同且不相关的两条路由
	 	
	
	-IP路由表
	 linux中使用命令 route -nee
		内核 IP 路由表
		Destination     Gateway         Genmask         Flags Metric Ref    Use Iface    MSS   Window irtt
		0.0.0.0         192.168.0.1     0.0.0.0         UG    600    0        0 wlp3s0   0     0      0
		10.8.0.0        10.8.0.1        255.255.255.0   UG    600    0        0 wlp3s0   0     0      0
		10.8.0.1        0.0.0.0         255.255.255.255 UH    600    0        0 wlp3s0   0     0      0
		169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0 wlp3s0   0     0      0
		192.168.0.0     0.0.0.0         255.255.255.0   U     600    0        0 wlp3s0   0     0      0
		192.168.122.0   0.0.0.0         255.255.255.0   U     0      0        0 virbr0   0     0      0
	 这里Destination + Genmask 就组成了前缀+掩码，比如第二条就是10.8.0.0/24这个子网的IP，它的下一条/出接口就是 Iface对应的网卡

15、host文件
	-操作系统(ubuntu 、windows等)一般都有hosts文件，这是一个没有后缀的文件	
		ubuntu : /etc/hosts
		windows: c:\Windows\System32\drivers\etc\hosts 
	 其作用就是将一些常用的网址域名与其对应的IP地址建立一个关联“数据库”，当用户在浏览器中输入一个需要登录的网址时，系统会首先自动从Hosts文件中寻找对应的IP地址，
	 一旦找到，系统会立即打开对应网页，如果没有找到，则系统会再将网址提交DNS域名解析服务器进行IP地址的解析。

	 需要注意的是，Hosts文件配置的映射是静态的。一旦一个域名和IP地址在Hosts文件中建立了映射关系，如果在网络上的计算机IP地址发生了更改，
	 用户需要及时更新Hosts文件中的对应映射，否则将不能正常访问。
	
	-ubuntu hosts文件修改
		cat hosts
		127.0.0.1	localhost
		127.0.1.1	sandro-Lenovo-XiaoXin-V4000
		
		# The following lines are desirable for IPv6 capable hosts
		::1     ip6-localhost ip6-loopback
		fe00::0 ip6-localnet
		ff00::0 ip6-mcastprefix
		ff02::1 ip6-allnodes
		ff02::2 ip6-allrouters
	 修改该文件需要root权限，将需要增加的ip和域名填入即可生效比如增加 
		192.168.1.1     family.10086.com
	 增加之后就可以通过自定义的域名 route.10086去访问192.168.1.1的移动网关管理页面了

16、路由模式和桥接模式
	-路由器与交换机区别
		1、设备类型不同
		   路由器，是连接两个或多个网络的硬件设备，在网络间其网关的作用，是读取每一个数据包中的地址，然后决定如何传送的专用只能性的网络设备
		   交换机，是一种在通信系统中完成信息交换功能的设备，是一种用于电/光信号转发的网络设备。

		2、功能不同
		   路由器，最主要的功能可以理解为实现信息的转送，把这个过程称之为寻址过程。因为路由器处在不同网络之间，但并不一定是信息的最终接收地址，所以在路由器中通常存在着一个路由表
		   交换机，交换机有带宽很高的内部交换矩阵和背部总线，并且这个背部总线上挂接了所有的端口，通过内部交换矩阵，就能够把数据包直接而迅速地传送到目的节点而非所有节点
			   这样就不会浪费网络资源，从而产生非常高的效率

		3、特点不同
		   路由器，核心是背板，高效的背板有助于提高路由器的性能，由于传统的共享总线式背板无法满足路由器的需要，所以采用结构可以用不同技术实现的交换式背板
		   交换机，交换机在同一时刻可进行多个端口之间的数据传输，每一端口都可视为独立的物理网段(注：非IP网段),连接在其上的网络设备独自享有全部的带宽，无须其他设备竞争使用

	-路由模式 (Route)
	 路由模式有点类似于支付宝，买家的钱先到支付宝，支付宝再到卖家，相似的网络数据先到路由器，路由器先发给设备(光猫)，再经过转发，把数据发送处去。
	 数据经过路由器和光猫设备转发发送处去，是一个三层的模式
	
	 路由模式也叫IP模式，在IP模式下就得先有一个IP地址，以太网接口获取IP地址的方法，一般有三种：Static,DHCP和PPPoE
	 注意：IPOE(DHCP+)是DHCP的一种特殊方式，DHCP基础上加了认证过程

	 优缺点：
		1、光猫在路由模式下，节省了单独购买路由器的额外支出
		2、路由模式适合连接设备不多的情况下
		3、路由模式下，光猫要完成光转电、拨号、分配DHCP，手法WIFI，数据链路处理等功能，在家庭中设备过多，数据交换量大的时候，光猫设备性能跟不上
		   会出现网络不稳定，网络卡顿、断流等情况，硬件资源消耗比较大

	-桥接模式(Bridge)
	 它相当与桥梁管道一样，只把两者连接起来进行实际的数据交换。都是用户和上层机房服务器直接交换，不经过第三方，光猫只启了一个光信号和电信号的相互转换作用，是一个二层模式
	 优缺点：
		1、光猫只负责光转电，关闭WIFI，其余的拨号、分配地址、数据处理功能都交给硬件配置强劲的路由器去做，减少硬件资源消耗
		2、减少数据转发层级更加稳定
		3、光猫维护不方便

	-常用经典组网方案-改光猫为桥接方法
	 家庭光猫最常用的是PPP协议，通过PPPOE方式认证获取IP地址
	 同样家庭无线路由器也有路由模式，通常运行PPPOE协议，如果家庭光猫使用了桥接模式，那么可以用家庭无线路由器实现PPPOE拨号，WAN口就获取了相应的出口地址，如图：16_光猫桥接模式	 

	 WAN口的桥接模式，相当于把WAN口配制成了LAN口类型用于连接两个相同的网段的局域网
	 光猫改成桥接模式，那么就不能配置路由信息，不能PPPOE拨号了，与运营商的局端设备属于同一网段，因此需要家庭的无线路由器PPPOE拨号
	 也可以这么理解"桥接"之后，光猫就相当与一根网线了，仅仅完成光电转换的功能。
	 修改光猫的连接模式需要超级密码，同时需要PPPOE拨号的用户名和密码，个人用户是没办法获取的。
	 		   
